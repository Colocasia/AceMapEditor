# AceMapEditor 需求文档

## 项目概述

**项目名称**: AceMapEditor
**项目类型**: 类星际2银河编辑器的游戏地图编辑器
**技术平台**: Unity Editor Extension（URP渲染管线）
**开发语言**: C#
**目标**: 开发功能完善的地图编辑器，支持地形编辑、单位放置、触发器系统等核心功能

---

## 核心功能概览

### 主要模块
1. **地形编辑器** - 地形高度、纹理混合、环境设置
2. **单位系统** - 单位放置、属性编辑、分组管理
3. **触发器系统** - 事件-条件-动作逻辑编程
4. **区域系统** - 区域绘制和管理
5. **数据编辑器** - 单位、技能、装饰物数据配置
6. **装饰物系统** - 装饰物放置和管理
7. **玩家设置** - 玩家配置和队伍关系
8. **文件管理** - 地图保存/加载、资源管理

---

## 开发阶段规划

### 第一阶段：核心框架（2周）

#### 目标
搭建编辑器基础框架，实现基本的编辑器窗口和场景交互

#### 功能需求
- [ ] 主编辑器窗口（AceMapEditorWindow）
  - 菜单栏（文件、编辑、视图、工具）
  - 工具栏
  - 基础UI布局

- [ ] SceneView集成
  - 场景视图事件处理
  - 鼠标交互（选择、拖拽、缩放）
  - Gizmos绘制

- [ ] 项目结构
  - Assembly Definition文件
  - 引擎抽象接口定义
  - 基础数据模型

#### 交付物
- 可打开的编辑器窗口
- 基本的场景交互
- 完整的项目代码结构

---

### 第二阶段：地形系统（3周）

#### 目标
实现完整的地形编辑功能，包括高度编辑和纹理混合

#### 功能需求

##### 2.1 地形网格系统
- [ ] 地形Mesh生成
  - 可配置分辨率（256x256, 512x512等）
  - 高度图存储和编辑
  - 法线计算

- [ ] 地形高度编辑
  - 升高/降低工具
  - 平滑工具
  - 设置高度工具
  - 笔刷大小、强度、衰减控制

##### 2.2 纹理混合系统
- [ ] Splatmap权重图管理
  - 支持多层纹理（4层起步）
  - 权重归一化
  - 实时预览

- [ ] URP Shader
  - TerrainBlend.shader
  - 多层纹理混合
  - 高度混合算法
  - 法线混合

- [ ] 纹理绘制工具
  - 纹理笔刷
  - 图层选择器
  - 笔刷预览

##### 2.3 场景视图工具
- [ ] 笔刷可视化
- [ ] 实时高度显示
- [ ] 网格辅助线

#### 交付物
- 可用的地形编辑器
- 支持高度编辑和纹理绘制
- 地形数据可保存和加载

---

### 第三阶段：单位和装饰物系统（2-3周）

#### 目标
实现单位和装饰物的放置、编辑和管理

#### 功能需求

##### 3.1 数据定义
- [ ] ScriptableObject定义
  - UnitDefinition（单位定义）
  - DoodadDefinition（装饰物定义）
  - 资源库组织

- [ ] 数据结构
  - UnitData（单位实例数据）
  - DoodadInstance（装饰物实例）

##### 3.2 单位系统
- [ ] 单位放置工具
  - 单位库浏览器
  - 拖拽放置
  - 位置、旋转调整

- [ ] 单位编辑
  - 属性面板
  - 所属玩家设置
  - 初始状态配置

- [ ] 单位管理
  - 选择和多选
  - 复制/粘贴
  - 删除
  - 分组

##### 3.3 装饰物系统
- [ ] 装饰物放置
  - 装饰物库
  - 单个放置
  - 批量放置（笔刷模式）

- [ ] 装饰物编辑
  - 位置、旋转、缩放
  - 随机变化（旋转、缩放）

#### 交付物
- 完整的单位放置和管理系统
- 装饰物系统
- 资源库窗口

---

### 第四阶段：触发器和区域系统（3-4周）

#### 目标
实现触发器编程系统和区域管理

#### 功能需求

##### 4.1 区域系统
- [ ] 区域绘制工具
  - 矩形区域
  - 圆形区域
  - 多边形区域（可选）

- [ ] 区域管理
  - 区域列表
  - 区域命名
  - 区域可视化（颜色标记）

##### 4.2 触发器系统架构
- [ ] 核心类设计
  - TriggerEvent（事件）
  - TriggerCondition（条件）
  - TriggerAction（动作）
  - Trigger（触发器）

- [ ] 变量系统
  - 全局变量
  - 局部变量
  - 变量类型（整数、浮点、布尔、字符串）

##### 4.3 触发器编辑器
- [ ] 触发器编辑窗口
  - 触发器列表
  - 事件-条件-动作编辑界面
  - 树形结构显示

- [ ] 内置事件
  - 游戏开始
  - 单位进入区域
  - 单位死亡
  - 定时器

- [ ] 内置条件
  - 数值比较
  - 单位状态判断

- [ ] 内置动作
  - 创建单位
  - 显示消息
  - 修改变量

#### 交付物
- 可用的触发器编辑器
- 基础的事件、条件、动作库
- 触发器序列化

---

### 第五阶段：数据编辑器（2-3周）

#### 目标
实现游戏数据的配置和编辑

#### 功能需求

##### 5.1 数据编辑器窗口
- [ ] 数据类型选择器
  - 单位
  - 技能
  - 装饰物

- [ ] 数据列表
  - 数据浏览
  - 搜索过滤
  - 新建/删除

##### 5.2 单位数据编辑
- [ ] 基础属性
  - 名称、描述
  - 生命值、能量值
  - 移动速度

- [ ] 视觉设置
  - Prefab引用
  - 图标

##### 5.3 技能数据编辑（可选）
- [ ] 技能属性
  - 伤害、范围
  - 冷却时间
  - 消耗

#### 交付物
- 数据编辑器窗口
- 单位数据配置功能
- 数据导入导出

---

### 第六阶段：优化和完善（2周）

#### 目标
性能优化、Bug修复、用户体验改进

#### 功能需求

##### 6.1 性能优化
- [ ] 大型地图性能测试
- [ ] 地形编辑优化
- [ ] 内存管理
- [ ] 序列化优化

##### 6.2 用户体验
- [ ] 撤销/重做系统
- [ ] 快捷键支持
- [ ] 工具提示
- [ ] 错误提示

##### 6.3 文件管理
- [ ] 地图保存/加载
- [ ] 地图信息编辑
- [ ] 地图预览图生成
- [ ] 版本管理（可选）

#### 交付物
- 稳定可用的编辑器
- 完善的用户体验
- 文档和教程（基础）

---

## 功能优先级

### P0 - 核心功能（必须实现）
- 编辑器框架
- 地形编辑（高度、纹理）
- 单位放置
- 地图保存/加载

### P1 - 重要功能
- 触发器系统
- 区域系统
- 装饰物系统
- 数据编辑器

### P2 - 增强功能
- 撤销/重做
- 快捷键
- 性能优化
- 用户体验改进

### P3 - 可选功能
- AI编辑器
- UI编辑器
- 摄像机系统
- 高级触发器功能

---

## 非功能性需求

### 性能要求
- 支持256x256单位的地图
- 实时编辑保持60 FPS
- 快速保存/加载（<5秒）

### 兼容性
- Unity 2021.3 LTS或更高
- Windows、macOS支持

### 可移植性
- 核心逻辑与Unity解耦
- 标准数据格式
- 接口抽象设计

### 易用性
- 直观的UI
- 工具提示
- 合理的默认值

---

## 参考项目

- **StarCraft II Galaxy Editor** - 功能完整的RTS地图编辑器
- **Warcraft III World Editor** - 触发器系统参考
- **Unity Terrain Tools** - 地形编辑参考
